

<div class="container" style='width: 100%; height: 100%;'>
	<div class="row" >
		<div class="col-md-12 col-sm-12 grey" style="height: 70px;">
			<input placeholder="Search by city, state or zip" class="city_input" type="text" style="margin-left: 4%; margin-top: 18px; width: 260px;"><button class="submit_button">Submit</button>
		</div>
	</div>
	<div class="row" style='width: 100%; height: 90%; min-height: 250px; padding-left: 3%; margin: 0px;'>
		<div class="col-md-12 col-sm-12" style='width: 100%; height: 100%;'>
			<div class='maps_container' style='width: 100%; margin: auto; height: 100%;'>
				<div id='multi_markers' style='width: 100%; height: 100%;'>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	var submit_button = $(".submit_button");
	submit_button.on('click', function() {
		var input = $('.city_input').val();
		// api call to google maps api too get lat and long from input box. then as long as the lat and long aren't 0 center the map onto that.
		$.getJSON({
			url: 'https://maps.googleapis.com/maps/api/geocode/json?address=' + input + '&key=<%=@google_api_key%>',
			success: function(results) {
				var location = [results.results[0].geometry.location.lat, results.results[0].geometry.location.lng];
				if (location[0] != 0 || location[1] != 0) {
					handler.map.centerOn(location);
				}
			}
		})
		
	})
	//builds the map with the distributer locations built in the controller
	var handler = Gmaps.build('Google');
	handler.buildMap({provider: { scrollwheel: true }, internal: {id: 'multi_markers'}}, function(){
		markers = handler.addMarkers([
			<% @distributers_list.each_with_index do |dist, i| %>
			    {
			      "lat": <%=@distributers_locations[i][0]%>,
			      "lng": <%=@distributers_locations[i][1]%>,
			      "infowindow": `

				      <%= dist[0] %><hr>
				      Address: <%= dist[1] %><hr>
				      Phone Number: <%= dist[2] %><hr>
				      <a href="<%=dist[3]%>">Website</a>
			      `
			    },
			<% end %>
		]);
		handler.bounds.extendWith(markers);
		handler.fitMapToBounds();
		console.log(<%=@user_location%>)
		// centers the map too the lat and long from ip address as long as there not 0
		if (<%=@user_location[0]%> != 0 || <%=@user_location[1]%> != 0) {
			handler.map.centerOn(<%=@user_location%>);
		}
	});
</script>

